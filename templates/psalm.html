{% extends "base.html" %}

{% block title %}Psalm {{ psalm.number }} - Pray150{% endblock %}

{% block head %}
<style>
    .psalm-text {
        font-family: Georgia, serif;
        line-height: 1.8;
        font-size: 16px;
        text-align: left;
        max-width: 800px;
        margin: 0 auto;
    }
    .verse-number {
        font-size: 14px;
        vertical-align: super;
        line-height: 1;
    }
    .psalm-title {
        font-family: Georgia, serif;
        letter-spacing: 0.5px;
    }
    .highlight {
        background-color: #fff3cd;
        padding: 2px;
        border-radius: 3px;
    }
    .note-marker {
        background-color: #d1ecf1;
        border-left: 3px solid #bee5eb;
        padding: 2px;
        border-radius: 3px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Psalm Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="psalm-header">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
                        <li class="breadcrumb-item active">Psalm {{ psalm.number }}</li>
                    </ol>
                </nav>
                <h1 class="h2 fw-bold mb-2">Psalm {{ psalm.number }}</h1>
                <h2 class="h4 text-muted mb-3">{{ psalm.title }}</h2>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Psalm Content -->
        <div class="col-lg-8">
            <!-- Psalm Text -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-transparent border-0 pt-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="fw-bold mb-0" style="color: #1e40af;">
                            <i class="fas fa-book-open me-2"></i>
                            Scripture Text
                        </h5>
                        <div class="psalm-controls">
                            <select class="form-select form-select-sm" id="translationSelect">
                                <option value="niv">NIV</option>
                                <option value="esv">ESV</option>
                                <option value="nlt">NLT</option>
                                <option value="nkjv">NKJV</option>
                                <option value="nrsv">NRSV</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="psalm-text" id="psalmText" data-psalm-number="{{ psalm.number }}" style="font-family: Georgia, serif; font-size: 16px; line-height: 1.8; max-width: 800px; margin: 0 auto;">
                        <div class="d-flex justify-content-center align-items-center" style="height: 100px;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading psalm text...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Markup Tools -->
                    <div class="markup-tools mt-3 pt-3 border-top">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-sm btn-outline-warning" id="highlightBtn">
                                <i class="fas fa-highlighter me-1"></i>Highlight
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-info" id="noteBtn">
                                <i class="fas fa-sticky-note me-1"></i>Add Note
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleMarkupsBtn">
                                <i class="fas fa-eye me-1"></i>Toggle Markups
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Music Player -->
            <div class="card border-0 shadow-sm mb-4" style="background: linear-gradient(135deg, #BFDBFE 0%, #FFFDD0 100%);">
                <div class="card-body">
                    <h5 class="fw-bold mb-3" style="color: #1e40af;">
                        <i class="fas fa-music me-2"></i>
                        Worship Along
                    </h5>
                    <div id="youtube-container" class="ratio ratio-16x9" style="max-width: 800px; margin: 0 auto;">
                        <div class="d-flex justify-content-center align-items-center bg-light rounded" style="height: 100%;">
                            <div class="text-muted">Loading worship music...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Tracking -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        Mark as Complete
                    </h5>
                    <form method="POST" action="{{ url_for('main.complete_psalm') }}">
                        <input type="hidden" name="psalm_id" value="{{ psalm.number }}">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="reading_time" class="form-label">Reading time (minutes)</label>
                                <input type="number" class="form-control" id="reading_time" name="reading_time" min="1" max="120">
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="music_listened" name="music_listened" value="true">
                                    <label class="form-check-label" for="music_listened">
                                        Listened to worship music
                                    </label>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success mt-3">
                            <i class="fas fa-check me-2"></i>Complete Psalm
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Journal Prompts Sidebar -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 pt-4">
                    <h5 class="fw-bold mb-0">
                        <i class="fas fa-journal-whills text-primary me-2"></i>
                        Journal Prompts
                    </h5>
                </div>
                <div class="card-body">
                    <form id="journalForm" data-psalm-id="{{ psalm.number }}">
                        <!-- Prompt 1 -->
                        <div class="journal-prompt mb-4">
                            <h6 class="fw-bold text-primary">1. Lord, where is my heart/soul today?</h6>
                            <textarea class="form-control journal-textarea" data-prompt="1" rows="3" 
                                      placeholder="Reflect on where your heart and soul are today...">{% if entries_dict and entries_dict.values() %}{{ entries_dict.values()|first.prompt_responses.get('1', '') }}{% endif %}</textarea>
                        </div>

                        <!-- Prompt 2 -->
                        <div class="journal-prompt mb-4">
                            <h6 class="fw-bold text-primary">2. LOOK! Lord, help me discover new truth from your Word today.</h6>
                            <textarea class="form-control journal-textarea" data-prompt="2" rows="3" 
                                      placeholder="What is the Psalm saying? What is this Psalm about?">{% if entries_dict and entries_dict.values() %}{{ entries_dict.values()|first.prompt_responses.get('2', '') }}{% endif %}</textarea>
                        </div>

                        <!-- Prompt 3 -->
                        <div class="journal-prompt mb-4">
                            <h6 class="fw-bold text-primary">3. LISTEN! Lord, what is your thought for me today from your Word?</h6>
                            <textarea class="form-control journal-textarea" data-prompt="3" rows="3" 
                                      placeholder="What is God speaking to you through this Psalm?">{% if entries_dict and entries_dict.values() %}{{ entries_dict.values()|first.prompt_responses.get('3', '') }}{% endif %}</textarea>
                        </div>

                        <!-- Prompt 4 -->
                        <div class="journal-prompt mb-4">
                            <h6 class="fw-bold text-primary">4. RESPOND: Lord, what do I need to talk to you about? What are you calling me to do?</h6>
                            <textarea class="form-control journal-textarea" data-prompt="4" rows="3" 
                                      placeholder="How will you respond to God? What action is He calling you to take?">{% if entries_dict and entries_dict.values() %}{{ entries_dict.values()|first.prompt_responses.get('4', '') }}{% endif %}</textarea>
                        </div>
                        
                        <!-- Auto-save status -->
                        <div class="text-center">
                            <small id="saveStatus" class="text-muted">Auto-saving...</small>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/psalm.js') }}"></script>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}
